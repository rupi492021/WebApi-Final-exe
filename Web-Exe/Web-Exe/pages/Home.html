<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>

    <script src="../Scripts/ajaxCalls.js"></script>
    <script src="../Scripts/jquery-1.10.2.min.js"></script>
    <link rel="stylesheet" href="https://sweet-modal.adepto.as/css/jquery.sweet-modal.min.css" />
    <script src="https://sweet-modal.adepto.as/js/jquery.sweet-modal.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }

        #main {
            width: 100%;
            height: 450PX;
            background-image: url('../imgs/img_res.png');
            background-size: 100% 100%;
            color: aliceblue;
            font-family: -webkit-pictograph;
        }

        a:hover {
            font-weight: bold;
            color: #d7ecf5;
        }

        #results {
            text-align: center;
        }

        #logo_text {
            padding-top: 150px;
            text-align: center;
        }

        h1 {
            margin: 0;
            padding: 0;
        }

        a {
            font-size: 1.8rem;
            text-align: right;
            vertical-align: middle;
            font-weight: 300;
            color: rgb(255, 255, 255);
            cursor: pointer;
            border-radius: 0.6rem;
            padding: 0.8rem !important;
            text-decoration: none;
            text-shadow: -.25px -.25px 0 black, .25px .25px black;
        }

            a:hover {
                font-weight: 700;
                color: #efd4b7;
            }

        .search {
            text-align: center;
        }

        #sl {
            width: 150px;
            height: 30Px;
        }

        .res {
            display: inline-block;
            width: 400px;
            /*height: 450PX;*/
            min-height: 350px;
            text-align: center;
            border: 1px solid #aeaeae;
            overflow: hidden;
            margin: 5px;
            padding: 5px;
            transform: translate3d(0px, 0px, 0px);
            border-radius: 20px;
            margin-left: 30px;
            box-shadow: 0px 4px 4px rgba(0,0,0,0.08), 0px 0px 2px rgba(0,0,0,0.08);
            background-color: #ffffff;
        }
        img {
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            width:100%;
        }

        h3 {
            font-size: 16px;
        }

        input[type=button] {
            border: 1px solid gray;
            background-color: #efd4b7;
            border-radius: 20px;
        }
        .area {
            font-size: 20px;
            text-align: center;
            border: 1px solid gray;
            background-color: #efd4b7;
            border-radius: 8px;
        }
    </style>

    <script>

        var id;
        var uri = "";
        var Attrlist = [];

        $(document).ready(function () {
            $(".area").hide();
            if (localStorage.length == 0) {
                $("#Bar").html('<a href="Manage.html">Admin</a><a href="Sign_up.html">Singup</a><a href="Login.html">Login</a>');
                $("#sl").change(search_category);
                ajaxCall("get", "../api/Businesses/", "", getSuccessAtr, getErrorAtr);
            }
            else {
                $("#Bar").html('<a href="Manage.html">Admin</a><a href="Preferences.html">Update Preferences</a><a href="" id="logout">Logout</a>');
                $("#sl").change(search_categoryByUser);
                id = localStorage.getItem('ID');
                ajaxCall("get", "../api/Attribute_In_cust/" + id, "", getSuccessAtrcust, getErrorAtrcust);

            }

            $("#logout").click(function () {
                console.log('logging out!');
                localStorage.removeItem('ID');
                $.sweetModal.confirm('Log out', 'Do you want to log out?', function () {
                    window.location = 'Home.html';
                });
                return false;
            });

        });
        // give attribute to resturant
        function getSuccessAtr(data) {
            render(data);
        }
        //    let count = 0;
        //    let list = [];
        //    for (i = 0; i < data.length; ) {
        //        var rand = Math.floor((Math.random() * 10) + 1);
        //        if (count == 5) {
        //            count = 0;
        //            list = [];
        //            i++;

        //        }
        //        else {
        //            if (list.includes(rand)) { }
        //            else {
        //                Attribute = {
        //                    Id_attr: rand,
        //                    Id_rest: data[i].Id
        //                }
        //                count++;
        //                list.push(rand);
        //                ajaxCall("POST", "../api/Attribute_In_rest", JSON.stringify(Attribute), postSuccess, postError)
        //            }

        //        }
        //    }
        //}
        function getErrorAtr() {
            console.log("error");

        }

        function viewinfo() {
            console.log($(this));
            id = $(this).attr('id');
            $(this).hide();
            $("#info" + id).show();
        }

        function PutSuccess() { }

        function PutError() { }

        //function postSuccess(data) {
        //    console.log(data);
        //}

        //function postError() {
        //    console.log("Error");
        //}

        //render resturant by category

        function getSuccessAtrcust(data) {
            Attrlist = data;
            for (i = 0; i < Attrlist.length; i++) {
                if (i == 0)
                    uri += "att_id=" + Attrlist[i].Id_att;
                else
                    uri += "att_id=" + Attrlist[i].Id_att;
                if ((i + 1) != Attrlist.length)
                    uri += "&";
            }
            console.log(uri);
            ajaxCall("get", "../api/Businesses/Byuser?" + uri, "", getSuccessAtrrand, getErrorAttrand);
        }
        function getSuccessAtrrand(data) {
            render(data);
        }
        function getErrorAttrand() { }

        function getErrorAtrcust() {

        }

        function search_category() {
            let category = $("#sl").find(":selected").text();
            ajaxCall("get", "../api/Businesses/" + category, "", getSuccess, getError);
            console.log(category);
            ajaxCall("get", "../api/Businesses/GetPromot/" + category, "", getSuccessPro, getErrorPro);
        }
        function search_categoryByUser() {
            let category = $("#sl").find(":selected").text();
            //  let api = category + "?attr_id=" + Attrlist[0] + "&attr_id=" + Attrlist[1] + "&attr_id="+Attrlist[2];
            ajaxCall("get", "../api/Businesses/" + category + "?" + uri, "", getSuccess, getError);
            ajaxCall("get", "../api/Businesses/GetPromotByUser/" + category + "?" + uri, "", getSuccessPro, getErrorPro);
        }

        function getSuccess(data) {
            render(data);
        }

        function getError() {
            console.log("error");
        }

        function getSuccessPro(data) {
            renderPro(data);
        }

        function getErrorPro() {
            console.log("error");
        }

        function render(data) {
            if (data.length)
                $("#organic").show();
            let str = "";
            for (i = 0; i < data.length; i++) {

                str += '<div class="res" style="width: 366px; min-width: 366px; margin-right: 20px;">';
                str += "<img src=\"" + data[i].Featured_image + "\" height=\"200px\" width=\"200px\"/> <br/>";
                str += "<b>Name:</b>" + data[i].Name + "<br />";
                str += "<b>Category:</b>" + data[i].Category + "<br />";
                str += "<input type='button' value='More info' id='" + data[i].Id + "' />";
                str += "<div id='info" + data[i].Id + "' style='display:none'>";
                str += "<b>User Rating:</b>" + data[i].User_rating + "<br />";
                str += "<b>Price Range:</b>" + data[i].Price_range + "<br />";
                str += "<b>Location:</b>" + data[i].Location + "<br />";
                str += "Phone Numbers:" + data[i].Phone_numbers + "<br />";
                str += '</div>';
                str += '</div>';


            }
            $("#Ph").html(str);
            $('.res > input[type=button]').click(viewinfo);
        }

        function renderPro(data) {
            if (data.length)
                $("#promo").show();
            let str = "";
            for (i = 0; i < data.length; i++) {

                str += '<div class="res">';
                str += "<img src=\"" + data[i].Featured_image + "\" height=\"200px\" width=\"200px\"/> <br/>";
                str += "<b>Name</b>:" + data[i].Name + "<br />";
                str += "<b>Category:</b>" + data[i].Category + "<br />";
                str += "<input type='button' value='More info' id='" + data[i].Id + "' />";
                str += "<div id='info" + data[i].Id + "' style='display:none'>";
                str += "<b>User Rating:</b>" + data[i].User_rating + "<br />";
                str += "<b>Price Range:</b>" + data[i].Price_range + "<br />";
                str += "<b>Location:</b>" + data[i].Location + "<br />";
                str += "<b>Phone Numbers:</b>" + data[i].Phone_numbers + "<br />";
                str += '</div>';
                str += '</div>';


            }
            $("#ph_pro").html(str);
            $('.res > input[type=button]').click(viewinfo);
            $('#ph_pro>input[type=button]').click(function () {
            ajaxCall("PUT", "../api/Campaign/Click/" + id, "", PutSuccess, PutError)

            });

        }

    </script>
</head>
<body>
    <div id="container">
        <div id="main">
            <div id="Bar"></div>
            <div id="logo_text">
                <h1>FindRest</h1>
                <h2>
                    The largest restaurant search engine in the world <br />
                    please choose a category
                </h2>
            </div>
            <div class="search">
                <select id="sl">
                    <option value="0"></option>
                    <option value="1">American</option>
                    <option value="3">Asian</option>
                    <option value="4">Arabian</option>
                    <option value="5">Desserts</option>
                    <option value="25">Chinese</option>
                    <option value="10">Oriental</option>
                    <option value="148">Indian</option>
                    <option value="156">Greek</option>
                    <option value="218">Israeli</option>
                    <option value="45">French</option>
                    <option value="73">Mexican</option>
                    <option value="95">Thai</option>
                    <option value="55">Italian</option>
                </select>
            </div>
        </div>
        <div id="results">
            <h3 class="area" id="promo">Sponsored area</h3>
            <div id="ph_pro"></div>
            <h3 class="area" id="organic">Organic area</h3>
            <div id="Ph"></div>
        </div>


    </div>

</body>
</html>